{"version":3,"file":"imageboardrenderer.min.js","sources":["../src/imageboardrenderer.js"],"sourcesContent":["/**\n * @param {string} cmid\n */\nexport const init = (cmid) => {\n    docReady(createimageboard(cmid));\n};\n\nconst docReady = (callback) => {\n    if (document.readyState === \"complete\" || document.readyState === \"interactive\") {\n        setTimeout(callback, 1);\n    } else {\n        document.addEventListener('DOMContentLoaded', callback);\n    }\n};\n\n/**\n * This is the function that do all the stuff after document.readyState === \"complete\" || document.readyState === \"interactive\"\n * @param {string} cmid\n */\nconst createimageboard = (cmid) => {\n    // First draw the canvas\n    drawCanvas(cmid);\n    // Second add the backgroundimage\n    drawBackgroundimage(cmid);\n    // Third add the images (this also draws the borders and adds click-eventlistener)\n    drawAllImages(cmid);\n    window.addEventListener(\"resize\", function() {\n        // First draw the canvas\n        drawCanvas(cmid);\n        // Second add the backgroundimage\n        drawBackgroundimage(cmid);\n        // Third add the images (this also draws the borders and adds click-eventlistener)\n        drawAllImages(cmid);\n        // ToDo: Check if it is better to now create the clickable areas instead of adding them in\n        // the drawAllImages espaccaly in drawOneImage function\n    });\n};\n\n\n/**\n * This function draws the canvas for the unilabel subplugin.\n * There can be more than one canvas on a page so the id {{cmid}} is needed.\n * An eventlistener listens to resize of the page and if width is not enought\n * then the canvas is rezised to 90%.\n *\n * @param {string} cmid\n */\nfunction drawCanvas(cmid) {\n    const myCanvas = document.getElementById(\"unilabeltype-imageboard-canvas-\" + cmid);\n    const myContext = myCanvas.getContext(\"2d\");\n    // Read the desired width and hight of the canvas\n    const canvaswidth = document.querySelector('.imageboard-'+cmid).getAttribute('data-canvaswidth');\n    const canvasheight = document.querySelector('.imageboard-'+cmid).getAttribute('data-canvasheight');\n    // Initialize variables\n    let newcanvaswidth = 1;\n    let widthfactor = 1;\n    let newcanvasheight = 1;\n\n    // Check if the browser width is big enough for the canvaswidth or if not then calculate 90% as \"newcanvaswidth\"\n    if (canvaswidth > getWidth()) {\n        newcanvaswidth = getWidth() * 0.90;\n        widthfactor = newcanvaswidth / canvaswidth;\n        newcanvasheight = canvasheight * widthfactor ;\n        myContext.canvas.width = newcanvaswidth;\n        myContext.canvas.height = newcanvasheight;\n    } else {\n        myContext.canvas.width = canvaswidth;\n        myContext.canvas.height = canvasheight;\n    }\n    /*\n    window.addEventListener(\"resize\", function() {\n        if (canvaswidth > getWidth()) {\n            newcanvaswidth = getWidth() * 0.90;\n            widthfactor =  newcanvaswidth / canvaswidth;\n            newcanvasheight = canvasheight * widthfactor ;\n            myContext.canvas.width = newcanvaswidth;\n            myContext.canvas.height = newcanvasheight;\n        } else {\n        }\n    }, false);\n    */\n}\n\n\n/**\n * Helper function to get the width of the usable browserarea.\n *\n * @returns {*|number}\n */\nfunction getWidth() {\n    if (self.innerWidth) {\n        return self.innerWidth;\n    }\n    if (document.documentElement && document.documentElement.clientWidth) {\n        return document.documentElement.clientWidth;\n    }\n    if (document.body) {\n        return document.body.clientWidth;\n    }\n}\n\n/**\n * @param {string} cmid\n */\nfunction drawAllImages(cmid) {\n    // Read all values that are the same for all images in order to not need this calls for every image\n    const canvaswidth = document.querySelector('.imageboard-'+cmid).getAttribute('data-canvaswidth');\n    const canvasheight = document.querySelector('.imageboard-'+cmid).getAttribute('data-canvasheight');\n    const showborders = document.querySelector('.imageboard-'+cmid).getAttribute('data-showborders');\n    const bordercolor = document.querySelector('.imageboard-'+cmid).getAttribute('data-bordercolor');\n    // loop all images and also pass the above values\n    document.querySelectorAll('.imageboardimage-'+cmid).forEach(image => {\n        drawOneImage(cmid,\n            canvaswidth,\n            canvasheight,\n            showborders,\n            bordercolor,\n            image.dataset);\n    });\n}\n\n/**\n * @param {string} cmid\n * @param {string} canvaswidth\n * @param {string} canvasheight\n * @param {bool} showborders\n * @param {string} bordercolor\n * @param {img} image\n */\nfunction drawOneImage(cmid,\n                      canvaswidth,\n                      canvasheight,\n                      showborders,\n                      bordercolor,\n                      image) {\n    let title = image.title;\n    let url = image.url;\n    let imageurl = image.imageurl;\n    let targetwidth = image.targetwidth;\n    let targetheight = image.targetheight;\n    let xposition = image.xposition;\n    let yposition = image.yposition;\n\n    const myCanvas = document.getElementById(\"unilabeltype-imageboard-canvas-\"+cmid);\n    const myContext = myCanvas.getContext(\"2d\");\n    const img = new Image();\n    let font = \"20px Arial\";\n    const fillstylebackground = '#f50';\n    img.src = imageurl;\n    let widthfactor = 1;\n    let titleheight = 0;\n\n        // Calculate a resize faktor if not enough width exists to display the canvas\n        if (canvaswidth > getWidth()) {\n            // Calculate a factor the width has to be scaled in order to let the canvas fit on the screen\n            widthfactor =  getWidth() * 0.90 / canvaswidth;\n        }\n\n        if (targetwidth != 0 && targetheight != 0) {\n        } else {\n            if (targetheight == 0) {\n                if (targetwidth == 0) {\n                    targetwidth = img.width;\n                    targetheight = img.height;\n                } else {\n                    let faktor = targetwidth / img.width;\n                    targetheight = img.height * faktor;\n                }\n            } else {\n                if (targetheight == 0) {\n                    targetwidth = img.width;\n                    targetheight = img.height;\n                } else {\n                    let faktor = targetheight / img.height;\n                    targetwidth = img.width * faktor;\n                }\n            }\n        }\n    img.onload = function() {\n        myContext.drawImage(img,\n            xposition * widthfactor,\n            yposition * widthfactor,\n            targetwidth * widthfactor,\n            targetheight * widthfactor);\n\n\n        if (showborders) {\n            let fill = false;\n            drawBorder(myContext,\n                xposition * widthfactor,\n                yposition * widthfactor,\n                targetwidth * widthfactor,\n                targetheight * widthfactor,\n                fill,\n                bordercolor,\n                1);\n        }\n\n        // Title\n        if (title != '') {\n            titleheight = 30;\n            myContext.fillStyle = fillstylebackground;\n            myContext.fillRect(xposition * widthfactor - 1,\n                yposition * widthfactor - (titleheight+1),\n                (targetwidth * widthfactor) + 1,\n                titleheight);\n            myContext.fillStyle = '#fff';\n            myContext.font = font;\n            myContext.fillText(title, xposition * widthfactor, yposition * widthfactor - 10);\n        }\n\n        // Add event listener for `click` events.\n        myCanvas.addEventListener('click', function(event) {\n            const rect = myCanvas.getBoundingClientRect();\n            const x = event.clientX - rect.left;\n            const y = event.clientY - rect.top;\n            if ((x > xposition * widthfactor && (x < xposition * widthfactor + targetwidth * widthfactor))\n                && (y > yposition * widthfactor - titleheight && (y < yposition * widthfactor + targetheight * widthfactor))) {\n                if (url){\n                    //window.open(url); // Use this to open in new tab\n                    window.location = url; // Use this to open in current window\n                }\n            } else {\n                const capababilityforgrid = document.querySelector('.imageboard-'+cmid).getAttribute('data-capababilityforgrid');\n                if (capababilityforgrid == '1') {\n                    drawGrid(cmid);\n                }\n            }\n        }, false);\n    };\n\n        // Now add eventlistener to resize canvas and images when needed.\n        /*\n        window.addEventListener(\"resize\", function() {\n            if (canvaswidth > getWidth()) {\n                widthfactor = getWidth() * 0.90 / canvaswidth;\n                myContext.drawImage(img,\n                    xposition * widthfactor,\n                    yposition * widthfactor,\n                    targetwidth * widthfactor,\n                    targetheight * widthfactor\n                );\n                if (showborders) {\n                    var fill = false;\n                    drawBorder(myContext, xposition * widthfactor,\n                        yposition * widthfactor,\n                        targetwidth * widthfactor,\n                        targetheight * widthfactor,\n                        fill, bordercolor,\n                        1\n                    );\n                }\n                // Title\n                if (title != '') {\n                    myContext.fillStyle = fillstylebackground;\n                    myContext.fillRect(xposition * widthfactor - 1,\n                        yposition * widthfactor - (titleheight+1),\n                        (targetwidth * widthfactor) + 1,\n                        titleheight);\n                    myContext.fillStyle = '#fff';\n                    myContext.font = font;\n                    myContext.fillText(title, xposition * widthfactor, yposition * widthfactor - 10);\n                }\n            }\n        }, false);\n\n         */\n}\n\n/**\n *\n * @param {string} ctx\n * @param {string} x x-position of the upper left corner\n * @param {string} y y-position of the upper left corner\n * @param {string} width\n * @param {string} height\n * @param {string} fill\n * @param {string} strokeStyle Color of the stroke to be drawn\n * @param {string} strokeWidth\n */\nfunction drawBorder(ctx, x, y, width, height, fill, strokeStyle, strokeWidth) {\n    ctx.beginPath();\n    ctx.rect(x, y, width, height);\n    ctx.shadowColor = '#f00';\n    ctx.shadowBlur = 0;\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    if (fill) {\n        ctx.fillStyle = fill;\n        ctx.fill();\n    }\n    if (strokeStyle) {\n        ctx.lineWidth = strokeWidth;\n        ctx.strokeStyle = strokeStyle;\n        ctx.stroke();\n    }\n}\n\n/**\n * Draw a grid on the canvas to support a better positioning of images.\n * myContext.canvas.width\n * @param {string} cmid\n */\nfunction drawGrid(cmid) {\n    const myCanvas = document.getElementById(\"unilabeltype-imageboard-canvas-\"+cmid);\n    const ctx = myCanvas.getContext(\"2d\");\n    let strokeStyle = \"#841ba1\";\n    let strokeWidth = 1;\n    const canvaswidth = document.querySelector('.imageboard-'+cmid).getAttribute('data-canvaswidth');\n    let widthfactor = ctx.canvas.width / canvaswidth;\n    ctx.beginPath();\n    let x = 1;\n    let y = 1;\n    for (let a = 1; a<15; a++) {\n        for (let i = 1; i<23; i++) {\n            ctx.rect(x, y, 50*widthfactor, 50*widthfactor);\n            x=x+50*widthfactor;\n        }\n        x = 1;\n        y = y+50*widthfactor;\n    }\n    if (strokeStyle) {\n        ctx.lineWidth = strokeWidth;\n        ctx.strokeStyle = strokeStyle;\n        ctx.stroke();\n    }\n}\n\n/**\n * @param {string} cmid\n */\nfunction drawBackgroundimage(cmid) {\n    const myCanvas = document.getElementById(\"unilabeltype-imageboard-canvas-\"+cmid);\n    const myContext = myCanvas.getContext(\"2d\");\n    var backgroundImage = new Image();\n    backgroundImage.src = document.querySelector('.imageboard-'+cmid).getAttribute('data-backgroundimage');\n    backgroundImage.onload = function() {\n        var canvaswidth = document.querySelector('.imageboard-'+cmid).getAttribute('data-canvaswidth');\n        var newcanvaswidth = 0;\n        if (canvaswidth > getWidth()) {\n            newcanvaswidth = getWidth() * 0.90;\n        } else {\n            newcanvaswidth = canvaswidth;\n        }\n        myContext.drawImage(backgroundImage, 0, 0, newcanvaswidth, backgroundImage.height * newcanvaswidth / backgroundImage.width);\n/*\n        window.addEventListener(\"resize\", function() {\n            if (canvaswidth > getWidth()) {\n                newcanvaswidth = getWidth() * 0.90;\n                myContext.drawImage(backgroundImage,\n                    0,\n                    0,\n                    newcanvaswidth,\n                    backgroundImage.height * newcanvaswidth / backgroundImage.width);\n            }\n        });\n */\n    };\n}\n"],"names":["cmid","docReady","createimageboard","callback","document","readyState","setTimeout","addEventListener","drawCanvas","drawBackgroundimage","drawAllImages","window","myContext","getElementById","getContext","canvaswidth","querySelector","getAttribute","canvasheight","newcanvaswidth","widthfactor","newcanvasheight","getWidth","canvas","width","height","self","innerWidth","documentElement","clientWidth","body","showborders","bordercolor","querySelectorAll","forEach","image","title","url","imageurl","targetwidth","targetheight","xposition","yposition","myCanvas","img","Image","font","fillstylebackground","src","titleheight","faktor","onload","drawImage","ctx","x","y","fill","strokeStyle","strokeWidth","beginPath","rect","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","fillStyle","lineWidth","stroke","drawBorder","fillRect","fillText","event","getBoundingClientRect","clientX","left","clientY","top","location","a","i","drawGrid","drawOneImage","dataset","backgroundImage"],"mappings":"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"}